/*
Programming for Data Science with Python Nanodegree
Udacity's certified program > SQL practice > Lesson 6 : SQL Window Functions

WINDOW FUNCTIONS:

Running total of standard_qty orderd by occurred_at and account_id
*/

SELECT occurred_at,
       account_id,
       standard_qty,
       SUM(standard_qty) OVER (ORDER BY occurred_at, account_id) AS running_total
FROM orders;

/*
Output6912 results

occurred_at	              account_id	standard_qty	running_total
2013-12-04T04:22:44.000Z	2861	        0	              0
2013-12-04T04:45:54.000Z	2861	      490	            490
2013-12-04T04:53:25.000Z	4311	      528	           1018
2013-12-05T20:29:16.000Z	1281	        0	           1018
2013-12-05T20:33:56.000Z	1281	      492	           1510
2013-12-06T02:13:20.000Z	2481	      502	           2012
2013-12-06T12:55:22.000Z	3431	       53	          2065
*/

/*
The result is unclear and need to be cleaned to understand more
The query below is same as above except having more clean data
*/

SELECT DATE_TRUNC('month', occurred_at),
       account_id,
       standard_qty,
       SUM(standard_qty) OVER (ORDER BY DATE_TRUNC('month', occurred_at), account_id) AS running_total
FROM orders;

/*
Output6912 results

date_trunc	account_id	standard_qty	running_total
2013-12-01T00:00:00.000Z	1181	339	339
2013-12-01T00:00:00.000Z	1251	484	909
2013-12-01T00:00:00.000Z	1251	86	909
2013-12-01T00:00:00.000Z	1281	0	1401
2013-12-01T00:00:00.000Z	1281	492	1401
2013-12-01T00:00:00.000Z	1301	477	1963
2013-12-01T00:00:00.000Z	1301	85	1963
2013-12-01T00:00:00.000Z	1401	38	2300
2013-12-01T00:00:00.000Z	1401	299	2300
2013-12-01T00:00:00.000Z	1411	150	2948
2013-12-01T00:00:00.000Z	1411	498	2948
2013-12-01T00:00:00.000Z	1441	317	3265
2013-12-01T00:00:00.000Z	1521	10	3541
2013-12-01T00:00:00.000Z	1521	266	3541
2013-12-01T00:00:00.000Z	1531	501	4042
2013-12-01T00:00:00.000Z	1531	0	4042
2013-12-01T00:00:00.000Z	1561	63	4485
2013-12-01T00:00:00.000Z	1561	380	4485
2013-12-01T00:00:00.000Z	1601	516	5001
2013-12-01T00:00:00.000Z	1701	148	5149
2013-12-01T00:00:00.000Z	1751	150	5299
2013-12-01T00:00:00.000Z	1791	481	5780
2013-12-01T00:00:00.000Z	1791	0	5780
2013-12-01T00:00:00.000Z	1871	289	6069
2013-12-01T00:00:00.000Z	1871	0	6069
2013-12-01T00:00:00.000Z	1881	501	8350
2013-12-01T00:00:00.000Z	1881	1780	8350
2013-12-01T00:00:00.000Z	1951	151	8501
2013-12-01T00:00:00.000Z	2051	498	8999
2013-12-01T00:00:00.000Z	2051	0	8999
2013-12-01T00:00:00.000Z	2081	311	9310
2013-12-01T00:00:00.000Z	2111	110	9420
2013-12-01T00:00:00.000Z	2181	278	9728
2013-12-01T00:00:00.000Z	2181	30	9728
2013-12-01T00:00:00.000Z	2231	51	10083
2013-12-01T00:00:00.000Z	2231	304	10083
2013-12-01T00:00:00.000Z	2331	142	10225
2013-12-01T00:00:00.000Z	2351	491	10716
2013-12-01T00:00:00.000Z	2351	0	10716
2013-12-01T00:00:00.000Z	2371	92	10808
2013-12-01T00:00:00.000Z	2381	1051	11859
2013-12-01T00:00:00.000Z	2381	0	11859
2013-12-01T00:00:00.000Z	2411	506	12365
2013-12-01T00:00:00.000Z	2461	0	12422
2013-12-01T00:00:00.000Z	2461	57	12422
2013-12-01T00:00:00.000Z	2481	502	12924
2013-12-01T00:00:00.000Z	2531	142	13066
2013-12-01T00:00:00.000Z	2541	69	13425
2013-12-01T00:00:00.000Z	2541	290	13425
2013-12-01T00:00:00.000Z	2571	34	13745
2013-12-01T00:00:00.000Z	2571	286	13745
2013-12-01T00:00:00.000Z	2591	310	14272
2013-12-01T00:00:00.000Z	2591	217	14272
2013-12-01T00:00:00.000Z	2631	6	14759
2013-12-01T00:00:00.000Z	2631	481	14759
2013-12-01T00:00:00.000Z	2731	490	15249
2013-12-01T00:00:00.000Z	2771	107	15857
2013-12-01T00:00:00.000Z	2771	501	15857
2013-12-01T00:00:00.000Z	2861	490	16347
2013-12-01T00:00:00.000Z	2861	0	16347
2013-12-01T00:00:00.000Z	2871	20	16900
2013-12-01T00:00:00.000Z	2871	533	16900
2013-12-01T00:00:00.000Z	2881	0	17397
2013-12-01T00:00:00.000Z	2881	497	17397
2013-12-01T00:00:00.000Z	2931	300	17765
2013-12-01T00:00:00.000Z	2931	68	17765
2013-12-01T00:00:00.000Z	2971	287	18093
2013-12-01T00:00:00.000Z	2971	41	18093
2013-12-01T00:00:00.000Z	3051	493	18586
2013-12-01T00:00:00.000Z	3101	119	19190
2013-12-01T00:00:00.000Z	3101	485	19190
2013-12-01T00:00:00.000Z	3141	501	19691
2013-12-01T00:00:00.000Z	3141	0	19691
2013-12-01T00:00:00.000Z	3251	75	20047
2013-12-01T00:00:00.000Z	3251	281	20047
2013-12-01T00:00:00.000Z	3371	79	20126
2013-12-01T00:00:00.000Z	3411	0	20441
2013-12-01T00:00:00.000Z	3411	315	20441
2013-12-01T00:00:00.000Z	3431	308	20802
2013-12-01T00:00:00.000Z	3431	53	20802
2013-12-01T00:00:00.000Z	3461	508	21310
2013-12-01T00:00:00.000Z	3471	353	21663
2013-12-01T00:00:00.000Z	3491	12	22136
2013-12-01T00:00:00.000Z	3491	461	22136
2013-12-01T00:00:00.000Z	3881	489	22625
2013-12-01T00:00:00.000Z	4111	304	22987
2013-12-01T00:00:00.000Z	4111	58	22987
2013-12-01T00:00:00.000Z	4151	67	23359
2013-12-01T00:00:00.000Z	4151	305	23359
2013-12-01T00:00:00.000Z	4161	504	23863
2013-12-01T00:00:00.000Z	4211	95	24472
2013-12-01T00:00:00.000Z	4211	514	24472
2013-12-01T00:00:00.000Z	4291	84	24853
2013-12-01T00:00:00.000Z	4291	297	24853
2013-12-01T00:00:00.000Z	4311	528	25381
2013-12-01T00:00:00.000Z	4341	639	26020
2013-12-01T00:00:00.000Z	4341	0	26020
2013-12-01T00:00:00.000Z	4451	491	26511
2013-12-01T00:00:00.000Z	4491	43	26554
2014-01-01T00:00:00.000Z	1181	511	27065
2014-01-01T00:00:00.000Z	1251	126	27191
2014-01-01T00:00:00.000Z	1281	491	27682
*/
